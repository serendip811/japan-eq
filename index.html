<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì¼ë³¸ ì§€ì§„ ë°ì´í„° ì‹œê°í™”</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
            color: #333;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 30px;
            font-size: 2.5em;
        }
        
        .header-info {
            text-align: center;
            margin-bottom: 40px;
            padding: 20px;
            background: #ecf0f1;
            border-radius: 8px;
        }
        
        .chart-section {
            margin-bottom: 50px;
        }
        
        .chart-title {
            font-size: 1.8em;
            color: #34495e;
            margin-bottom: 20px;
            border-bottom: 3px solid #3498db;
            padding-bottom: 10px;
        }
        
        .chart-container {
            background: #fafafa;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #ddd;
            margin-bottom: 20px;
        }
        
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        .data-table th,
        .data-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        
        .data-table th {
            background-color: #3498db;
            color: white;
            font-weight: bold;
        }
        
        .data-table tr:hover {
            background-color: #f5f5f5;
        }
        
        .magnitude-high {
            color: #e74c3c;
            font-weight: bold;
        }
        
        .magnitude-medium {
            color: #f39c12;
            font-weight: bold;
        }
        
        .magnitude-low {
            color: #27ae60;
        }
        
        .footer {
            text-align: center;
            margin-top: 50px;
            padding: 20px;
            background: #2c3e50;
            color: white;
            border-radius: 8px;
        }
        
        .update-info {
            font-size: 0.9em;
            color: #7f8c8d;
            text-align: center;
            margin-bottom: 20px;
        }
        
        .loading {
            text-align: center;
            padding: 50px;
            font-size: 1.2em;
            color: #7f8c8d;
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
</head>
<body>
    <div class="container">
        <h1>ğŸŒ ì¼ë³¸ ì§€ì§„ ë°ì´í„° ì‹œê°í™”</h1>
        
        <div class="header-info">
            <p><strong>ì‹¤ì‹œê°„ ì§€ì§„ ì •ë³´ë¥¼ ì‹œê°í™”í•˜ì—¬ ì œê³µí•©ë‹ˆë‹¤</strong></p>
            <p>ë°ì´í„° ì¶œì²˜: <a href="https://www.data.jma.go.jp/multi/quake/index.html?lang=kr">ì¼ë³¸ ê¸°ìƒì²­</a></p>
        </div>
        
        <div id="loading" class="loading">
            ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...
        </div>
        
        <div id="content" style="display: none;">
            <div class="update-info">
                <span id="lastUpdate">ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: -</span>
            </div>
            
            <div class="chart-section">
                <h2 class="chart-title">ğŸ“Š ê·œëª¨ë³„ ì§€ì§„ ë°œìƒ íšŸìˆ˜</h2>
                <div class="chart-container">
                    <div id="magnitudeChart"></div>
                </div>
            </div>
            
            <div class="chart-section">
                <h2 class="chart-title">â° ì‹œê°„ëŒ€ë³„ ì§€ì§„ ë°œìƒ ë¶„í¬</h2>
                <div class="chart-container">
                    <div id="timeChart"></div>
                </div>
            </div>
            
            <div class="chart-section">
                <h2 class="chart-title">ğŸ—¾ ì§€ì—­ë³„ ì§€ì§„ ë°œìƒ íšŸìˆ˜</h2>
                <div class="chart-container">
                    <div id="regionChart"></div>
                </div>
            </div>
            
            <div class="chart-section">
                <h2 class="chart-title">ğŸ” ê¹Šì´ë³„ ì§€ì§„ ë¶„í¬</h2>
                <div class="chart-container">
                    <div id="depthChart"></div>
                </div>
            </div>
            
            <div class="chart-section">
                <h2 class="chart-title">ğŸ“‹ ìµœê·¼ ì§€ì§„ ëª©ë¡</h2>
                <div class="chart-container">
                    <table class="data-table" id="earthquakeTable">
                        <thead>
                            <tr>
                                <th>ë°œìƒì‹œê°</th>
                                <th>ì§„ì•™ì§€</th>
                                <th>ê·œëª¨</th>
                                <th>ê¹Šì´</th>
                                <th>ìµœëŒ€ì§„ë„</th>
                            </tr>
                        </thead>
                        <tbody id="earthquakeTableBody">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <div class="footer">
            <p>ğŸ”„ ë°ì´í„°ëŠ” ë§¤ì‹œê°„ ìë™ìœ¼ë¡œ ì—…ë°ì´íŠ¸ë©ë‹ˆë‹¤</p>
            <p>GitHub Actionsë¥¼ í†µí•´ ìë™ìœ¼ë¡œ ìˆ˜ì§‘ ë° ì²˜ë¦¬ë©ë‹ˆë‹¤</p>
        </div>
    </div>
    
    <script>
        async function loadData() {
            try {
                const response = await fetch('./data/latest.json');
                const data = await response.json();
                
                // ì—…ë°ì´íŠ¸ ì‹œê°„ í‘œì‹œ
                document.getElementById('lastUpdate').textContent = 
                    `ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: ${new Date(data.fetchedAt).toLocaleString('ko-KR')}`;
                
                // ì°¨íŠ¸ ë¡œë“œ
                await loadCharts();
                
                // í…Œì´ë¸” ìƒì„±
                createEarthquakeTable(data.earthquakes);
                
                // ë¡œë”© ìˆ¨ê¸°ê³  ì»¨í…ì¸  í‘œì‹œ
                document.getElementById('loading').style.display = 'none';
                document.getElementById('content').style.display = 'block';
                
            } catch (error) {
                console.error('ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
                document.getElementById('loading').innerHTML = 'ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.';
            }
        }
        
        async function loadCharts() {
            try {
                // Mermaid ì´ˆê¸°í™”
                mermaid.initialize({ startOnLoad: false });
                
                // ì°¨íŠ¸ ë°ì´í„° ë¡œë“œ
                const response = await fetch('./data/latest.json');
                const data = await response.json();
                
                // ê° ì°¨íŠ¸ ìƒì„±
                createMagnitudeChart(data.earthquakes);
                createTimeChart(data.earthquakes);
                createRegionChart(data.earthquakes);
                createDepthChart(data.earthquakes);
                
            } catch (error) {
                console.error('ì°¨íŠ¸ ë¡œë“œ ì‹¤íŒ¨:', error);
            }
        }
        
        function createMagnitudeChart(earthquakes) {
            const magnitudeRanges = {
                '1.0-2.9': 0,
                '3.0-3.9': 0,
                '4.0-4.9': 0,
                '5.0-5.9': 0,
                '6.0-6.9': 0,
                '7.0+': 0
            };
            
            earthquakes.forEach(eq => {
                const mag = parseFloat(eq.magnitude) || 0;
                if (mag >= 7.0) magnitudeRanges['7.0+']++;
                else if (mag >= 6.0) magnitudeRanges['6.0-6.9']++;
                else if (mag >= 5.0) magnitudeRanges['5.0-5.9']++;
                else if (mag >= 4.0) magnitudeRanges['4.0-4.9']++;
                else if (mag >= 3.0) magnitudeRanges['3.0-3.9']++;
                else magnitudeRanges['1.0-2.9']++;
            });
            
            const chartDef = `
                xychart-beta
                title "ê·œëª¨ë³„ ì§€ì§„ ë°œìƒ íšŸìˆ˜"
                x-axis [${Object.keys(magnitudeRanges).map(k => `"${k}"`).join(', ')}]
                y-axis "ë°œìƒ íšŸìˆ˜"
                bar [${Object.values(magnitudeRanges).join(', ')}]
            `;
            
            const element = document.getElementById('magnitudeChart');
            mermaid.render('magnitudeChart-svg', chartDef).then(result => {
                element.innerHTML = result.svg;
            });
        }
        
        function createTimeChart(earthquakes) {
            const hourCounts = new Array(24).fill(0);
            
            earthquakes.forEach(eq => {
                const hour = new Date(eq.dateTime).getHours();
                hourCounts[hour]++;
            });
            
            const chartDef = `
                xychart-beta
                title "ì‹œê°„ëŒ€ë³„ ì§€ì§„ ë°œìƒ ë¶„í¬"
                x-axis [${Array.from({length: 24}, (_, i) => `"${i}ì‹œ"`).join(', ')}]
                y-axis "ë°œìƒ íšŸìˆ˜"
                line [${hourCounts.join(', ')}]
            `;
            
            const element = document.getElementById('timeChart');
            mermaid.render('timeChart-svg', chartDef).then(result => {
                element.innerHTML = result.svg;
            });
        }
        
        function createRegionChart(earthquakes) {
            const regionCounts = {};
            
            earthquakes.forEach(eq => {
                const region = eq.epicenter || 'ê¸°íƒ€';
                regionCounts[region] = (regionCounts[region] || 0) + 1;
            });
            
            const sortedRegions = Object.entries(regionCounts)
                .sort(([,a], [,b]) => b - a)
                .slice(0, 10);
            
            const chartDef = `
                xychart-beta
                title "ì§€ì—­ë³„ ì§€ì§„ ë°œìƒ íšŸìˆ˜ (Top 10)"
                x-axis [${sortedRegions.map(([region]) => `"${region}"`).join(', ')}]
                y-axis "ë°œìƒ íšŸìˆ˜"
                bar [${sortedRegions.map(([,count]) => count).join(', ')}]
            `;
            
            const element = document.getElementById('regionChart');
            mermaid.render('regionChart-svg', chartDef).then(result => {
                element.innerHTML = result.svg;
            });
        }
        
        function createDepthChart(earthquakes) {
            const depthRanges = {
                '0-10km': 0,
                '11-50km': 0,
                '51-100km': 0,
                '101-200km': 0,
                '201km+': 0
            };
            
            earthquakes.forEach(eq => {
                const depth = parseInt(eq.depth) || 0;
                if (depth > 200) depthRanges['201km+']++;
                else if (depth > 100) depthRanges['101-200km']++;
                else if (depth > 50) depthRanges['51-100km']++;
                else if (depth > 10) depthRanges['11-50km']++;
                else depthRanges['0-10km']++;
            });
            
            const chartDef = `
                xychart-beta
                title "ê¹Šì´ë³„ ì§€ì§„ ë¶„í¬"
                x-axis [${Object.keys(depthRanges).map(k => `"${k}"`).join(', ')}]
                y-axis "ë°œìƒ íšŸìˆ˜"
                bar [${Object.values(depthRanges).join(', ')}]
            `;
            
            const element = document.getElementById('depthChart');
            mermaid.render('depthChart-svg', chartDef).then(result => {
                element.innerHTML = result.svg;
            });
        }
        
        function createEarthquakeTable(earthquakes) {
            const tbody = document.getElementById('earthquakeTableBody');
            tbody.innerHTML = '';
            
            earthquakes.slice(0, 20).forEach(eq => {
                const row = document.createElement('tr');
                
                // ê·œëª¨ì— ë”°ë¥¸ ìƒ‰ìƒ í´ë˜ìŠ¤ ê²°ì •
                let magnitudeClass = 'magnitude-low';
                if (eq.magnitude >= 6.0) magnitudeClass = 'magnitude-high';
                else if (eq.magnitude >= 4.0) magnitudeClass = 'magnitude-medium';
                
                row.innerHTML = `
                    <td>${eq.dateTime}</td>
                    <td>${eq.epicenter}</td>
                    <td class="${magnitudeClass}">${eq.magnitude}</td>
                    <td>${eq.depth}km</td>
                    <td>${eq.maxIntensity}</td>
                `;
                
                tbody.appendChild(row);
            });
        }
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ë°ì´í„° ë¡œë“œ
        document.addEventListener('DOMContentLoaded', loadData);
    </script>
</body>
</html>