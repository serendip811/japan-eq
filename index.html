<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì¼ë³¸ ì§€ì§„ ë°ì´í„° ì‹œê°í™”</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
            color: #333;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 30px;
            font-size: 2.5em;
        }
        
        .header-info {
            text-align: center;
            margin-bottom: 40px;
            padding: 20px;
            background: #ecf0f1;
            border-radius: 8px;
        }
        
        .chart-section {
            margin-bottom: 50px;
        }
        
        .chart-title {
            font-size: 1.8em;
            color: #34495e;
            margin-bottom: 20px;
            border-bottom: 3px solid #3498db;
            padding-bottom: 10px;
        }
        
        .chart-container {
            background: #fafafa;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #ddd;
            margin-bottom: 20px;
        }
        
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        .data-table th,
        .data-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        
        .data-table th {
            background-color: #3498db;
            color: white;
            font-weight: bold;
        }
        
        .data-table tr:hover {
            background-color: #f5f5f5;
        }
        
        .magnitude-high {
            color: #e74c3c;
            font-weight: bold;
        }
        
        .magnitude-medium {
            color: #f39c12;
            font-weight: bold;
        }
        
        .magnitude-low {
            color: #27ae60;
        }
        
        .footer {
            text-align: center;
            margin-top: 50px;
            padding: 20px;
            background: #2c3e50;
            color: white;
            border-radius: 8px;
        }
        
        .update-info {
            font-size: 0.9em;
            color: #7f8c8d;
            text-align: center;
            margin-bottom: 20px;
        }
        
        .loading {
            text-align: center;
            padding: 50px;
            font-size: 1.2em;
            color: #7f8c8d;
        }
        
        .filter-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
            border: 2px solid #e9ecef;
        }
        
        .filter-controls {
            display: flex;
            align-items: center;
            gap: 20px;
            flex-wrap: wrap;
        }
        
        .filter-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .filter-label {
            font-weight: bold;
            color: #2c3e50;
            min-width: 80px;
        }
        
        .filter-select {
            padding: 8px 12px;
            border: 2px solid #bdc3c7;
            border-radius: 5px;
            font-size: 14px;
            background: white;
            min-width: 120px;
        }
        
        .filter-select:focus {
            outline: none;
            border-color: #3498db;
        }
        
        .filter-button {
            background: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
        }
        
        .filter-button:hover {
            background: #2980b9;
        }
        
        .filter-button.reset {
            background: #95a5a6;
        }
        
        .filter-button.reset:hover {
            background: #7f8c8d;
        }
        
        .filter-status {
            background: #e8f5e8;
            color: #27ae60;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
        }
    </style>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<body>
    <div class="container">
        <h1>ğŸŒ ì¼ë³¸ ì§€ì§„ ë°ì´í„° ì‹œê°í™”</h1>
        
        <div class="header-info">
            <p><strong>ì‹¤ì‹œê°„ ì§€ì§„ ì •ë³´ë¥¼ ì‹œê°í™”í•˜ì—¬ ì œê³µí•©ë‹ˆë‹¤</strong></p>
            <p>ë°ì´í„° ì¶œì²˜: <a href="https://www.data.jma.go.jp/multi/quake/index.html?lang=kr">ì¼ë³¸ ê¸°ìƒì²­</a></p>
        </div>
        
        <div id="loading" class="loading">
            ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...
        </div>
        
        <div id="content" style="display: none;">
            <div class="update-info">
                <span id="lastUpdate">ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: -</span>
            </div>
            
            <div class="filter-section">
                <h3 style="margin-top: 0; color: #2c3e50;">ğŸ” ë°ì´í„° í•„í„°ë§</h3>
                <div class="filter-controls">
                    <div class="filter-group">
                        <label class="filter-label" for="magnitudeFilter">ì§„ë„ ë²”ìœ„:</label>
                        <select id="magnitudeFilter" class="filter-select">
                            <option value="all">ì „ì²´ ë³´ê¸°</option>
                            <option value="1">1.0 ì´ìƒ</option>
                            <option value="2">2.0 ì´ìƒ</option>
                            <option value="3">3.0 ì´ìƒ</option>
                            <option value="4">4.0 ì´ìƒ</option>
                            <option value="5">5.0 ì´ìƒ</option>
                            <option value="6">6.0 ì´ìƒ</option>
                            <option value="7">7.0 ì´ìƒ</option>
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <label class="filter-label" for="dateFilter">ê¸°ê°„:</label>
                        <select id="dateFilter" class="filter-select">
                            <option value="all">ì „ì²´ ê¸°ê°„</option>
                            <option value="7">ìµœê·¼ 7ì¼</option>
                            <option value="30">ìµœê·¼ 30ì¼</option>
                            <option value="90">ìµœê·¼ 90ì¼</option>
                        </select>
                    </div>
                    
                    <button id="applyFilter" class="filter-button">í•„í„° ì ìš©</button>
                    <button id="resetFilter" class="filter-button reset">ì´ˆê¸°í™”</button>
                    
                    <div id="filterStatus" class="filter-status" style="display: none;">
                        í•„í„° ì ìš©ë¨
                    </div>
                </div>
            </div>
            
            <div class="chart-section">
                <h2 class="chart-title">ğŸ“Š ê·œëª¨ë³„ ì§€ì§„ ë°œìƒ íšŸìˆ˜</h2>
                <div class="chart-container">
                    <div id="magnitudeChart" style="height: 400px;"></div>
                </div>
            </div>
            
            <div class="chart-section">
                <h2 class="chart-title">ğŸ—¾ ì§€ì—­ë³„ ì§€ì§„ ë°œìƒ íšŸìˆ˜</h2>
                <div class="chart-container">
                    <div id="regionChart" style="height: 400px;"></div>
                </div>
            </div>
            
            <div class="chart-section">
                <h2 class="chart-title">ğŸ” ê¹Šì´ë³„ ì§€ì§„ ë¶„í¬</h2>
                <div class="chart-container">
                    <div id="depthChart" style="height: 400px;"></div>
                </div>
            </div>
            
            <div class="chart-section">
                <h2 class="chart-title">ğŸ“… ì¼ìë³„ ì§€ì§„ ë°œìƒ ë¹ˆë„</h2>
                <div class="chart-container">
                    <div id="dailyFrequencyChart" style="height: 500px;"></div>
                </div>
            </div>
            
            <div class="chart-section">
                <h2 class="chart-title">ğŸ“ˆ ì§€ì§„ ë°œìƒ ì¶”ì„¸ ë¶„ì„</h2>
                <div class="chart-container">
                    <div id="trendChart" style="height: 400px;"></div>
                </div>
            </div>
            
            <div class="chart-section">
                <h2 class="chart-title">ğŸ—ºï¸ 3D ì§€ì§„ ë¶„í¬ ì§€ë„</h2>
                <div class="chart-container">
                    <div id="map3dChart" style="height: 600px;"></div>
                </div>
            </div>
            
            <div class="chart-section">
                <h2 class="chart-title">ğŸ”¥ ì›”ë³„ ì§€ì§„ ë°œìƒ íˆíŠ¸ë§µ</h2>
                <div class="chart-container">
                    <div id="heatmapChart" style="height: 400px;"></div>
                </div>
            </div>
            
            <div class="chart-section">
                <h2 class="chart-title">ğŸ“‹ ìµœê·¼ ì§€ì§„ ëª©ë¡</h2>
                <div class="chart-container">
                    <table class="data-table" id="earthquakeTable">
                        <thead>
                            <tr>
                                <th>ë°œìƒì‹œê°</th>
                                <th>ì§„ì•™ì§€</th>
                                <th>ê·œëª¨</th>
                                <th>ê¹Šì´</th>
                                <th>ìµœëŒ€ì§„ë„</th>
                            </tr>
                        </thead>
                        <tbody id="earthquakeTableBody">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <div class="footer">
            <p>ğŸ”„ ë°ì´í„°ëŠ” ë§¤ì‹œê°„ ìë™ìœ¼ë¡œ ì—…ë°ì´íŠ¸ë©ë‹ˆë‹¤</p>
            <p>GitHub Actionsë¥¼ í†µí•´ ìë™ìœ¼ë¡œ ìˆ˜ì§‘ ë° ì²˜ë¦¬ë©ë‹ˆë‹¤</p>
        </div>
    </div>
    
    <script>
        // ì „ì—­ ë³€ìˆ˜
        let allEarthquakeData = [];
        let filteredData = [];
        
        async function loadData() {
            try {
                const response = await fetch('./data/latest.json');
                const data = await response.json();
                
                // ì „ì—­ ë°ì´í„° ì €ì¥
                allEarthquakeData = data.earthquakes;
                filteredData = [...allEarthquakeData];
                
                // ì—…ë°ì´íŠ¸ ì‹œê°„ í‘œì‹œ
                document.getElementById('lastUpdate').textContent = 
                    `ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: ${new Date(data.fetchedAt).toLocaleString('ko-KR')}`;
                
                // í•„í„° ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
                setupFilterEventListeners();
                
                // ì°¨íŠ¸ ë¡œë“œ
                await loadCharts();
                
                // í…Œì´ë¸” ìƒì„±
                createEarthquakeTable(filteredData);
                
                // ë¡œë”© ìˆ¨ê¸°ê³  ì»¨í…ì¸  í‘œì‹œ
                document.getElementById('loading').style.display = 'none';
                document.getElementById('content').style.display = 'block';
                
            } catch (error) {
                console.error('ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
                document.getElementById('loading').innerHTML = 'ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.';
            }
        }
        
        // í•„í„° ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
        function setupFilterEventListeners() {
            document.getElementById('applyFilter').addEventListener('click', applyFilters);
            document.getElementById('resetFilter').addEventListener('click', resetFilters);
        }
        
        // ë°ì´í„° í•„í„°ë§ í•¨ìˆ˜
        function filterData() {
            const magnitudeFilter = document.getElementById('magnitudeFilter').value;
            const dateFilter = document.getElementById('dateFilter').value;
            
            let filtered = [...allEarthquakeData];
            
            // ì§„ë„ í•„í„°ë§
            if (magnitudeFilter !== 'all') {
                const minMagnitude = parseFloat(magnitudeFilter);
                filtered = filtered.filter(eq => {
                    const magnitude = parseFloat(eq.magnitude) || 0;
                    return magnitude >= minMagnitude;
                });
            }
            
            // ë‚ ì§œ í•„í„°ë§
            if (dateFilter !== 'all') {
                const daysAgo = parseInt(dateFilter);
                const cutoffDate = new Date();
                cutoffDate.setDate(cutoffDate.getDate() - daysAgo);
                
                filtered = filtered.filter(eq => {
                    const eqDate = new Date(eq.dateTime);
                    return eqDate >= cutoffDate;
                });
            }
            
            return filtered;
        }
        
        // í•„í„° ì ìš©
        function applyFilters() {
            filteredData = filterData();
            
            // ëª¨ë“  ì°¨íŠ¸ ì—…ë°ì´íŠ¸
            updateAllCharts();
            
            // í…Œì´ë¸” ì—…ë°ì´íŠ¸
            createEarthquakeTable(filteredData);
            
            // í•„í„° ìƒíƒœ í‘œì‹œ
            updateFilterStatus();
        }
        
        // í•„í„° ì´ˆê¸°í™”
        function resetFilters() {
            document.getElementById('magnitudeFilter').value = 'all';
            document.getElementById('dateFilter').value = 'all';
            
            filteredData = [...allEarthquakeData];
            
            // ëª¨ë“  ì°¨íŠ¸ ì—…ë°ì´íŠ¸
            updateAllCharts();
            
            // í…Œì´ë¸” ì—…ë°ì´íŠ¸
            createEarthquakeTable(filteredData);
            
            // í•„í„° ìƒíƒœ ìˆ¨ê¸°ê¸°
            document.getElementById('filterStatus').style.display = 'none';
        }
        
        // í•„í„° ìƒíƒœ ì—…ë°ì´íŠ¸
        function updateFilterStatus() {
            const magnitudeFilter = document.getElementById('magnitudeFilter').value;
            const dateFilter = document.getElementById('dateFilter').value;
            const statusElement = document.getElementById('filterStatus');
            
            if (magnitudeFilter !== 'all' || dateFilter !== 'all') {
                let statusText = `í•„í„° ì ìš© (${filteredData.length}/${allEarthquakeData.length}ê±´)`;
                statusElement.textContent = statusText;
                statusElement.style.display = 'block';
            } else {
                statusElement.style.display = 'none';
            }
        }
        
        // ëª¨ë“  ì°¨íŠ¸ ì—…ë°ì´íŠ¸
        function updateAllCharts() {
            createMagnitudeChart(filteredData);
            createRegionChart(filteredData);
            createDepthChart(filteredData);
            createDailyFrequencyChart(filteredData);
            createTrendChart(filteredData);
            create3DMapChart(filteredData);
            createHeatmapChart(filteredData);
        }
        
        async function loadCharts() {
            try {
                // ê° ì°¨íŠ¸ ìƒì„± (filteredData ì‚¬ìš©)
                createMagnitudeChart(filteredData);
                createRegionChart(filteredData);
                createDepthChart(filteredData);
                
                // ìƒˆë¡œìš´ ê³ ê¸‰ ì°¨íŠ¸ ìƒì„±
                createDailyFrequencyChart(filteredData);
                createTrendChart(filteredData);
                create3DMapChart(filteredData);
                createHeatmapChart(filteredData);
                
            } catch (error) {
                console.error('ì°¨íŠ¸ ë¡œë“œ ì‹¤íŒ¨:', error);
            }
        }
        
        function createMagnitudeChart(earthquakes) {
            const magnitudeRanges = {
                '1.0-2.9': 0,
                '3.0-3.9': 0,
                '4.0-4.9': 0,
                '5.0-5.9': 0,
                '6.0-6.9': 0,
                '7.0+': 0
            };
            
            earthquakes.forEach(eq => {
                const mag = parseFloat(eq.magnitude) || 0;
                if (mag >= 7.0) magnitudeRanges['7.0+']++;
                else if (mag >= 6.0) magnitudeRanges['6.0-6.9']++;
                else if (mag >= 5.0) magnitudeRanges['5.0-5.9']++;
                else if (mag >= 4.0) magnitudeRanges['4.0-4.9']++;
                else if (mag >= 3.0) magnitudeRanges['3.0-3.9']++;
                else magnitudeRanges['1.0-2.9']++;
            });
            
            const trace = {
                x: Object.keys(magnitudeRanges),
                y: Object.values(magnitudeRanges),
                type: 'bar',
                marker: {
                    color: ['#2ecc71', '#3498db', '#f1c40f', '#e67e22', '#e74c3c', '#8e44ad']
                }
            };
            
            const layout = {
                title: 'ê·œëª¨ë³„ ì§€ì§„ ë°œìƒ íšŸìˆ˜',
                xaxis: { title: 'ì§€ì§„ ê·œëª¨' },
                yaxis: { title: 'ë°œìƒ íšŸìˆ˜' },
                showlegend: false,
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)'
            };
            
            Plotly.newPlot('magnitudeChart', [trace], layout, {responsive: true});
        }
        
        function createRegionChart(earthquakes) {
            const regionCounts = {};
            
            earthquakes.forEach(eq => {
                const region = eq.epicenterKr || eq.epicenter || 'ê¸°íƒ€';
                regionCounts[region] = (regionCounts[region] || 0) + 1;
            });
            
            const sortedRegions = Object.entries(regionCounts)
                .sort(([,a], [,b]) => b - a)
                .slice(0, 10);
            
            const trace = {
                x: sortedRegions.map(([region]) => region),
                y: sortedRegions.map(([,count]) => count),
                type: 'bar',
                marker: {
                    color: '#3498db'
                }
            };
            
            const layout = {
                title: 'ì§€ì—­ë³„ ì§€ì§„ ë°œìƒ íšŸìˆ˜ (Top 10)',
                xaxis: { title: 'ì§€ì—­' },
                yaxis: { title: 'ë°œìƒ íšŸìˆ˜' },
                showlegend: false,
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)'
            };
            
            Plotly.newPlot('regionChart', [trace], layout, {responsive: true});
        }
        
        function createDepthChart(earthquakes) {
            const depthRanges = {
                '0-10km': 0,
                '11-50km': 0,
                '51-100km': 0,
                '101-200km': 0,
                '201km+': 0
            };
            
            earthquakes.forEach(eq => {
                const depth = parseInt(eq.depth) || 0;
                if (depth > 200) depthRanges['201km+']++;
                else if (depth > 100) depthRanges['101-200km']++;
                else if (depth > 50) depthRanges['51-100km']++;
                else if (depth > 10) depthRanges['11-50km']++;
                else depthRanges['0-10km']++;
            });
            
            const trace = {
                x: Object.keys(depthRanges),
                y: Object.values(depthRanges),
                type: 'bar',
                marker: {
                    color: '#e67e22'
                }
            };
            
            const layout = {
                title: 'ê¹Šì´ë³„ ì§€ì§„ ë¶„í¬',
                xaxis: { title: 'ê¹Šì´ ë²”ìœ„' },
                yaxis: { title: 'ë°œìƒ íšŸìˆ˜' },
                showlegend: false,
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)'
            };
            
            Plotly.newPlot('depthChart', [trace], layout, {responsive: true});
        }
        
        // ì¼ìë³„ ì§€ì§„ ë°œìƒ ë¹ˆë„ ì°¨íŠ¸
        function createDailyFrequencyChart(earthquakes) {
            const dailyCounts = {};
            
            earthquakes.forEach(eq => {
                const date = eq.dateTime.split(' ')[0];
                dailyCounts[date] = (dailyCounts[date] || 0) + 1;
            });
            
            const sortedDates = Object.keys(dailyCounts).sort();
            const recentDates = sortedDates.slice(-30); // ìµœê·¼ 30ì¼
            
            const trace = {
                x: recentDates,
                y: recentDates.map(date => dailyCounts[date]),
                type: 'scatter',
                mode: 'lines+markers',
                name: 'ì¼ì¼ ì§€ì§„ ë°œìƒ ê±´ìˆ˜',
                line: { color: '#e74c3c', width: 3 },
                marker: { size: 6, color: '#c0392b' }
            };
            
            const layout = {
                title: 'ìµœê·¼ 30ì¼ ì¼ìë³„ ì§€ì§„ ë°œìƒ ë¹ˆë„',
                xaxis: { title: 'ë‚ ì§œ' },
                yaxis: { title: 'ë°œìƒ ê±´ìˆ˜' },
                showlegend: false,
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)'
            };
            
            Plotly.newPlot('dailyFrequencyChart', [trace], layout, {responsive: true});
        }
        
        // ì§€ì§„ ë°œìƒ ì¶”ì„¸ ë¶„ì„ ì°¨íŠ¸ (7ì¼ ì´ë™í‰ê· )
        function createTrendChart(earthquakes) {
            const dailyCounts = {};
            
            earthquakes.forEach(eq => {
                const date = eq.dateTime.split(' ')[0];
                dailyCounts[date] = (dailyCounts[date] || 0) + 1;
            });
            
            const sortedDates = Object.keys(dailyCounts).sort();
            const movingAverage = [];
            
            for (let i = 6; i < sortedDates.length; i++) {
                const avg = sortedDates.slice(i-6, i+1)
                    .reduce((sum, date) => sum + (dailyCounts[date] || 0), 0) / 7;
                movingAverage.push({date: sortedDates[i], avg});
            }
            
            const recent = movingAverage.slice(-60); // ìµœê·¼ 60ì¼
            
            const trace = {
                x: recent.map(item => item.date),
                y: recent.map(item => item.avg),
                type: 'scatter',
                mode: 'lines',
                name: '7ì¼ ì´ë™í‰ê· ',
                line: { color: '#3498db', width: 4 },
                fill: 'tozeroy',
                fillcolor: 'rgba(52, 152, 219, 0.1)'
            };
            
            const layout = {
                title: 'ì§€ì§„ ë°œìƒ ì¶”ì„¸ (7ì¼ ì´ë™í‰ê· )',
                xaxis: { title: 'ë‚ ì§œ' },
                yaxis: { title: 'í‰ê·  ë°œìƒ ê±´ìˆ˜' },
                showlegend: false,
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)'
            };
            
            Plotly.newPlot('trendChart', [trace], layout, {responsive: true});
        }
        
        // 3D ì§€ì§„ ë¶„í¬ ì§€ë„
        function create3DMapChart(earthquakes) {
            const validEqs = earthquakes.filter(eq => eq.coordinates && eq.coordinates.includes('+'));
            
            const lats = [];
            const lons = [];
            const magnitudes = [];
            const depths = [];
            const texts = [];
            
            validEqs.forEach(eq => {
                try {
                    const coords = eq.coordinates.split('/')[0];
                    const latMatch = coords.match(/([+-]\d+\.\d+)/g);
                    if (latMatch && latMatch.length >= 2) {
                        const lat = parseFloat(latMatch[0]);
                        const lon = parseFloat(latMatch[1]);
                        const depth = parseInt(eq.depth) || 0;
                        
                        lats.push(lat);
                        lons.push(lon);
                        magnitudes.push(parseFloat(eq.magnitude) || 0);
                        depths.push(depth);
                        texts.push(`${eq.epicenterKr || eq.epicenter}<br>ê·œëª¨: ${eq.magnitude}<br>ê¹Šì´: ${eq.depth}<br>${eq.dateTime}`);
                    }
                } catch (error) {
                    console.warn('ì¢Œí‘œ íŒŒì‹± ì‹¤íŒ¨:', eq.coordinates);
                }
            });
            
            const trace = {
                type: 'scatter3d',
                mode: 'markers',
                x: lons,
                y: lats,
                z: depths,
                text: texts,
                hoverinfo: 'text',
                marker: {
                    size: magnitudes.map(m => Math.max(3, m * 2)),
                    color: magnitudes,
                    colorscale: [
                        [0, '#2ecc71'],
                        [0.3, '#f1c40f'],
                        [0.6, '#e67e22'],
                        [1, '#e74c3c']
                    ],
                    colorbar: {
                        title: 'ê·œëª¨',
                        thickness: 15
                    },
                    opacity: 0.8
                }
            };
            
            const layout = {
                title: '3D ì§€ì§„ ë¶„í¬ (ìœ„ë„, ê²½ë„, ê¹Šì´)',
                scene: {
                    xaxis: { title: 'ê²½ë„' },
                    yaxis: { title: 'ìœ„ë„' },
                    zaxis: { title: 'ê¹Šì´ (km)', autorange: 'reversed' }
                },
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)'
            };
            
            Plotly.newPlot('map3dChart', [trace], layout, {responsive: true});
        }
        
        // ì›”ë³„ ì§€ì§„ ë°œìƒ íˆíŠ¸ë§µ (ì›” vs ê·œëª¨)
        function createHeatmapChart(earthquakes) {
            const monthlyData = {};
            const magnitudeRanges = ['1.0-2.9', '3.0-3.9', '4.0-4.9', '5.0-5.9', '6.0-6.9', '7.0+'];
            
            // ì›”ë³„ë¡œ ë°ì´í„° ì´ˆê¸°í™”
            earthquakes.forEach(eq => {
                const month = eq.dateTime.substring(0, 7); // YYYY-MM í˜•íƒœ
                if (!monthlyData[month]) {
                    monthlyData[month] = {
                        '1.0-2.9': 0,
                        '3.0-3.9': 0,
                        '4.0-4.9': 0,
                        '5.0-5.9': 0,
                        '6.0-6.9': 0,
                        '7.0+': 0
                    };
                }
                
                const mag = parseFloat(eq.magnitude) || 0;
                if (mag >= 7.0) monthlyData[month]['7.0+']++;
                else if (mag >= 6.0) monthlyData[month]['6.0-6.9']++;
                else if (mag >= 5.0) monthlyData[month]['5.0-5.9']++;
                else if (mag >= 4.0) monthlyData[month]['4.0-4.9']++;
                else if (mag >= 3.0) monthlyData[month]['3.0-3.9']++;
                else monthlyData[month]['1.0-2.9']++;
            });
            
            const months = Object.keys(monthlyData).sort();
            const heatmapZ = magnitudeRanges.map(range => 
                months.map(month => monthlyData[month][range])
            );
            
            const trace = {
                z: heatmapZ,
                x: months,
                y: magnitudeRanges,
                type: 'heatmap',
                colorscale: [
                    [0, '#ecf0f1'],
                    [0.2, '#3498db'],
                    [0.4, '#2ecc71'],
                    [0.6, '#f1c40f'],
                    [0.8, '#e67e22'],
                    [1, '#e74c3c']
                ],
                colorbar: {
                    title: 'ë°œìƒ ê±´ìˆ˜',
                    thickness: 15
                }
            };
            
            const layout = {
                title: 'ì›”ë³„ ê·œëª¨ë³„ ì§€ì§„ ë°œìƒ íŒ¨í„´',
                xaxis: { 
                    title: 'ì›”',
                    tickangle: -45
                },
                yaxis: { title: 'ì§€ì§„ ê·œëª¨' },
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)'
            };
            
            Plotly.newPlot('heatmapChart', [trace], layout, {responsive: true});
        }
        
        function createEarthquakeTable(earthquakes) {
            const tbody = document.getElementById('earthquakeTableBody');
            tbody.innerHTML = '';
            
            earthquakes.slice(0, 20).forEach(eq => {
                const row = document.createElement('tr');
                
                // ê·œëª¨ì— ë”°ë¥¸ ìƒ‰ìƒ í´ë˜ìŠ¤ ê²°ì •
                let magnitudeClass = 'magnitude-low';
                if (eq.magnitude >= 6.0) magnitudeClass = 'magnitude-high';
                else if (eq.magnitude >= 4.0) magnitudeClass = 'magnitude-medium';
                
                row.innerHTML = `
                    <td>${eq.dateTime}</td>
                    <td>${eq.epicenterKr || eq.epicenter}</td>
                    <td class="${magnitudeClass}">${eq.magnitude}</td>
                    <td>${eq.depth}km</td>
                    <td>${eq.maxIntensity}</td>
                `;
                
                tbody.appendChild(row);
            });
        }
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ë°ì´í„° ë¡œë“œ
        document.addEventListener('DOMContentLoaded', loadData);
    </script>
</body>
</html>